<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="/static/css/index.css">
    <link rel="stylesheet" type="text/css" href="/static/css/root.css">
    <title>Log Analyzer Tool</title>
</head>
<body>
    {% include 'nav_bar.html' ignore missing %}
    <div class="content">
        <a href="/ingest">Click here to ingest logs from QA dashboard</a>
    </div>
    <div class="content">
        <h3>Ingested Logs</h3>
        <div>
            <input type="checkbox" id="qa" name="job_filter" value="log_qa-" checked onclick="onSelectFilter(this);">
            <label for="qa">QA jobs</label>

            <input type="checkbox" id="fod" name="job_filter" value="log_fond-job" onclick="onSelectFilter(this);">
            <label for="fod">Fun-on-demand jobs</label>
        </div>
        <table class="index">
            <thead>
                <tr>
                    <th>Job ID</th>
                    <th>Ingested Time (in UTC)</th>
                    <th>Log Lines</th>
                    <th>Log Analyzer Storage</th>
                </tr>
            </thead>
            <tbody>
            {% for log in logs %}
                <tr class="log-row" data-job_name="{{log.name}}">
                    <td><a href="/log/{{log.name}}/dashboard">{{log.name}}</a></td>
                    <td class="fixed-font">{{log.creation_date}}</td>
                    <td class="right-align fixed-font">{{log.doc_count}}</td>
                    <td class="right-align fixed-font caps">{{log.es_size}}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</body>
<script type="text/javascript">
    const logRows = Array.from(document.getElementsByClassName("log-row"));
    const checkedFilters = Array.from(document.getElementsByName("job_filter")).filter(element => element.checked);
    let selectedFilters = [];

    // Self invocation function called when the page loads
    (function() {
        selectedFilters = checkedFilters.map(element => element.value);
        updateJobs();
    })();

    function onSelectFilter(element) {
        if (element.checked) {
            selectedFilters.push(element.value);
        }
        else {
            selectedFilters = selectedFilters.filter(filter => filter !== element.value);
        }
        updateJobs();
    }

    function updateJobs() {
        // Loop over all the rows and hide
        // the ones which not selected
        logRows.forEach(row => {
            const job_name = row.dataset.job_name;
            if (selectedFilters.length === 0 ||
                selectedFilters.some(filter => job_name.startsWith(filter))
            ) {
                row.style.display = "";
                return;
            }
            row.style.display = "none";
        });
    }

</script>
</html>
