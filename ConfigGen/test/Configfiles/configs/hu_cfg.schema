{
	"Schema" : {
		// Subset of http://json-schema.org/
		// Validator: https://www.jsonschemavalidator.net
		// Documentation: https://cswr.github.io/JsonSchema/
		// Reference: https://json-schema.org/understanding-json-schema/reference/

		//"$schema": "http://json-schema.org/draft-07/schema#",
		//"$id": "http://json-schema.org/draft-07/schema#",
		"title": "Json-Schema definition for FunOS.",

		"type": "object",
		"required": [ "HostUnits", "HostUnit", "HostUnitController", "HostUnitFunction" ],

		// HU schema:
		// defines HUs, HU, HU controllers, HU PFs for hu config C code generation for SBP
		"properties": {

			"HostUnits": {
				"title": "HostUnits",
				"description": "Defines number of HostUnits enabled",
				"type": "object",
				"required": ["hu_en"],
				"properties": {
					"hu_en": {
						"type": "integer", "maximum": 255, "minimum": 0,
						"description": "bitmap hu_en,HU0-5 are HW HUs, HU6 is FunOS HU, and HU7 is Eumulated HU for NVMeoF and Test"
					}
				}
			},
			"HostUnit": {
				"title": "HostUnit",
				"type": "array",
				"maxItems" : 8,     // number hus including s/w simulated instance
				"minItems" : 1,
				"description": "Defines each HostUnit",

				"items": {
					"type": "object",
					"required": ["_args", "ctl_en", "bif_mode"],
					"properties": {
						"_args": {
							"type": "array",
							"description": "1D array index, [hu slice]",
							"maxItems" : 1,
							"minItems" : 1,
							"items": [
								{
									"oneOf": [
										{ "type": "string", "pattern": "^all$" }, // "all"
										{ "type": "integer", "maximum": 7, "minimum": 0 }
									]
								}
							]
						},
						"ctl_en": {
							"type": "integer", "maximum": 15, "minimum": 0,
							"description": "controller enable bitmap [3..0], 0001"
						},
						"bif_mode": {
							"type": "string",
							"description": "bifrication mode",
							"enum": [ "BIF_ONE_16", "BIF_TWO_8", "BIF_FOUR_4", "BIF_HYBRID"]
						}
					}
				},
				"additionalItems": false
			},

			"HostUnitController" : {
				"title": "HostUnitController",
				"description": "Defines HostUnitController",
				"type": "array",    // [hu slice][hu controller]
				"maxItems" : 32,    // 32 = 8 x 4
				"minItems" : 1,

				"items" : {
					"type": "object",
					"required": ["_args", "pf_en", "nvf_en", "mode"],
					"properties": {
						"_args": {
							"type": "array",
							"description": "2D array index, [hu slice][controller id]",
							"maxItems" : 2,
							"minItems" : 2,
							"items": [
								{
									"oneOf": [  // hu slice
										{ "type": "string", "pattern": "^all$" }, // len("all")
										{ "type": "integer", "maximum": 7, "minimum": 0 }
									]
								},
								{
									"oneOf": [  // controller
										{ "type": "string", "pattern": "^all$" }, // len("all")
										{ "type": "integer", "maximum": 3, "minimum": 0 }
									]
								},
							]
						},
						"pf_en" : {
							"type" : "integer", "maximum": 255,
							"description" : "physical function enable bitmap [7..0], all 0xff"
						},
						"nvf_en" : {
							"type" : "array",
							"maxItems" : 8,
							"description" : "number enabled VFs/PF [pfn0..pfn7]",
							"items" : {
								"type" : "integer"
							}
						},
						"mode" : {
							"type": "string",
							"description": "controller mode",
							"enum": [ "EP", "RC" ]
						},
						"pcie_gen" : {
							"type" : "string",
							"description": "PCIe generation type",
							"enum" : ["GEN1", "GEN2", "GEN3", "GEN4"]
						},
						"pcie_width" : {
							"type" : "string",
							"enum" : ["x1", "x2", "x4", "x8", "x16"]
						}
					}
				},
				"additionalItems": false
			},

			"HostUnitFunction" : {
				"title": "HostUnitController",
				"description": "Defines HostUnitController, _args takes 4 args, but use 3d array for code generation",
				"type": "array",
				"maxItems" : 512,   // for code gen: only generates PF entry[8 (HU_NUM)][4 (HU_CTL_NUM)][8 (PF)] [vf 2 (0 or all)]
									// json array is ordered for index, but "_args" is used for explicit index
				"items" : {
					"type" : "object",
					"required": ["_args"],
						//"id_vid", "id_did", "rid", "cc_pi", "cc_scc", "cc_bcc",
						//"pf_bar_sz", "vf_bar_sz", "msix_tbl_sz", "ats_en", "pri_en", "exp_rom_en",
						//"tph_en", "pasid_en", "msix_bar", "sq_msb_sticky_en", "cq_msb_sticky_en"],

					"properties": {
						"_args": {
							"type": "array",
							"description": "4d array index, [hu slice][controller id][pf]",
							"maxItems": 4/* [hu slice][controller id][pf][vf]*/,
							"minItems": 4/* [hu slice][controller id][pf][vf]*/,
							"items": [{
								"oneOf": [  // hu slice
								{
									"type": "string", "pattern": "^all$"
								},
								{
									"type": "integer", "maximum": 7, "minimum": 0
								} // hu_num: including h/w instance and s/w simulated instance
								]
							},
							{
								"oneOf": [  // controller
								{
									"type": "string", "pattern": "^all$"
								},
								{
									"type": "integer", "maximum": 3, "minimum": 0
								} // hu_ctl_num
								]
							},
							{
								"oneOf": [  // pf
								{
									"type": "string", "pattern": "^all$"
								},
								{
									"type": "integer", "maximum": 7, "minimum": 0
								} // max pf: hu_fnp_num including h/w instance and s/w simulated instance
								]
							},
							{
								"oneOf": [  // vf 'all|0'
								{ // vf definition, "all" is for vf
									"type": "string", "pattern": "all$"
								},
								{ // 0: no vf
									"type": "integer", "maximum": 0, "minimum": 0
								}
								]
							},
							]
						},
						"id_vid" : {
							"type" : "integer",
							"description" : "vendor identifier"
						},
						"id_did" : {
							"type" : "integer",
							"description" : "device identifier"
						},
						"rid" : {
							"type" : "integer",
							"description" : "revision identifier"
						},
						"cc_pi" : {
							"type" : "integer",
							"description" : "programming interface"
						},
						"cc_scc" : {
							"type" : "integer",
							"description" : "sub class code"
						},
						"cc_bcc" : {
							"type" : "integer",
							"description" : "base class code"
						},

						//
						// hsu hw configs
						//
						"pf_bar_sz" :   {
							"type" : "integer",
							"description" : "in log2"
						},
						"vf_bar_sz" :   {
							"type" : "integer",
							"description" : "in log2"
						},
						"msix_tbl_sz": {
							"type" : "integer"
						},
						"ats_en" : {
							"type" : "integer"
						},
						"pri_en" : {
							"type" : "integer"
						},
						"exp_rom_en" : {
							"type" : "integer",
							"description" : "expansion rom"
						},
						"tph_en" : {
							"type" : "integer"
						},
						"pasid_en" : {
							"type" : "integer"
						},
						"msix_bar" : {
							"type" : "integer"
						},
						"sq_msb_sticky_en" : {
							"type" : "integer"
						},
						"cq_msb_sticky_en" : {
							"type" : "integer"
						},

						//
						// bar0/1 MMIO, app
						//
						"cap_mpsmax" : {
							"type" : "integer",
							"description" : "memory page size maximum"
						},
						"cap_mpsmin" : {
							"type" : "integer",
							"description" : "memory page size minimum"
						},
						"cap_css" :  {
							"type" : "integer",
							"description" : "command sets supported"
						},
						"cap_nssrs" : {
							"type" : "integer",
							"description" : "nvm subsystem reset supported"
						},
						"cap_dstrd" : {
							"type" : "integer",
							"description" : "doorbell stride"
						},
						"cap_to" : {
							"type" : "integer",
							"description" : "timeout (8secs)"
						},
						"cap_ams" : {
							"type" : "integer",
							"description" : "arbitration mechanism supported"
						},
						"cap_cqr" : {
							"type" : "integer",
							"description" : "contiguous queues required"
						},
						"cap_mqes" : {
							"type" : "integer",
							"description" : "maximum queue entries supported"
						},
						"vs_mjr" : {
							"type" : "integer",
							"description" : "major version number"
						},
						"vs_mnr" : {
							"type" : "integer",
							"description" : "minor version number"
						},
						"vs_ter" : {
							"type" : "integer",
							"description" : "tertiary version number"
						},

						//
						// resources, funos
						//
						"nepsq" : {
							"type" : "integer",
							"description" : "number of submission queues"
						},
						"nepcq" : {
							"type" : "integer",
							"description" : "number of completion queues"
						},
						"neth" : {
							"type" : "integer",
							"description" : "neth"
						},
						"nvi" : {
							"type" : "integer",
							"description" : "nvi"
						},
						"nport" : {
							"type" : "integer",
							"description" : "number of ports"
						},
						"nsocket" : {
							"type" : "integer",
							"description" : "number of sockets"
						},
						"ntcp" : {
							"type" : "integer",
							"description" : "number of tcp connections"
						},
						"nrdma" : {
							"type" : "integer",
							"description" : "number of rdma QPs"
						},
						"nxform" : {
							"type" : "integer",
							"description" : "number of crypto xform ctx"
						},
						"ntestflow" : {
							"type" : "integer",
							"description" : "number of testflow flows"
						}
					}
				},
				"additionalItems": false
			}
		}
	}
}
